@if (item(); as item) {
<div
  class="group bg-slate-800 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 overflow-hidden border border-slate-700 hover:border-blue-500/50 h-full flex flex-col cursor-pointer relative">

  <!-- Bookmark Button (Absolute) -->
  <button (click)="toggleSave($event)" title="Save to Library"
    class="absolute top-3 right-3 z-10 p-2 rounded-full bg-slate-900/80 hover:bg-slate-700 transition-colors backdrop-blur-sm border border-slate-700/50">
    @if(isSaved()) {
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-400" viewBox="0 0 20 20" fill="currentColor">
      <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z" />
    </svg>
    } @else {
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 group-hover:text-white transition-colors"
      fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z" />
    </svg>
    }
  </button>

  @if (layout() === 'grid') {
  <!-- GRID VIEW -->

  <!-- Image Section -->
  <div class="relative h-48 overflow-hidden bg-slate-900 group">
    @if (!imageError() && item.imageUrl) {
    <img [src]="item.imageUrl" [alt]="item.imageAlt || item.title"
      class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
      (error)="onImageError()" />
    } @else {
    <!-- Fallback Image -->
    <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-800 to-slate-900 p-6">
      <div class="text-center">
        <h3 class="text-xl font-bold text-slate-700 uppercase tracking-widest break-words">{{ item.source }}</h3>
      </div>
    </div>
    }

    <!-- Overlay Gradient -->
    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/20 to-transparent opacity-60"></div>

    <!-- Score Band & Evidence Label (Top Left/Right) -->
    <!-- Note: Bookmark is top right. Let's put these top left or below bookmark? -->
    <!-- Original design had them top right. Bookmark overlays them? -->
    <!-- Let's put them top left. -->
    <div class="absolute top-3 left-3 flex flex-col gap-2 items-start">
      @if (item.scoreBand) {
      <span
        class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider border backdrop-blur-md shadow-lg text-white border-white/20"
        [class]="scoreBandClass()">
        {{ item.scoreBand }}
      </span>
      }
      @if (item.evidenceQuality) {
      <span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider border backdrop-blur-md shadow-lg"
        [class]="evidenceColor()">
        {{ evidenceLabel() }}
      </span>
      }
    </div>
  </div>

  <!-- Content Body -->
  <div class="p-5 flex flex-col flex-grow">
    <!-- Meta -->
    <div class="flex items-center gap-2 mb-3 text-xs font-medium text-slate-400">
      <span class="text-blue-400 font-bold uppercase tracking-wider">{{ item.source }}</span>
      <span>•</span>
      <span>{{ item.publishedDate | date:'mediumDate' }}</span>
      <span>•</span>
      <span>{{ item.readTime || '5 min read' }}</span>
    </div>

    <!-- Title -->
    <h3
      class="text-lg font-bold text-slate-100 mb-3 leading-snug group-hover:text-blue-400 transition-colors line-clamp-2">
      {{ item.title }}
    </h3>

    <!-- Why it Matters -->
    @if (item.executiveSummary?.whyWeHighlightThis) {
    <div class="mb-3 p-3 bg-blue-900/20 border-l-2 border-blue-500 rounded-r">
      <p class="text-[10px] font-bold text-blue-300 uppercase tracking-wide mb-1">Why it Matters</p>
      <p class="text-xs text-slate-300 line-clamp-2 italic">
        "{{ item.executiveSummary?.whyWeHighlightThis }}"
      </p>
    </div>
    }

    <!-- Summary -->
    <p class="text-sm text-slate-400 leading-relaxed line-clamp-3 mb-4 flex-grow">
      {{ item.summary }}
    </p>

    <!-- Footer -->
    <div class="mt-auto pt-4 border-t border-slate-700/50 flex flex-wrap gap-1.5">
      @for(tag of item.tags; track tag) {
      <span class="px-2 py-0.5 text-[10px] font-semibold rounded bg-slate-700 text-slate-300 border border-slate-600">
        {{ tag }}
      </span>
      }
    </div>
  </div>

  } @else {
  <!-- LIST VIEW -->
  <div class="flex items-center p-4 gap-4 h-auto min-h-[5rem]">
    <!-- Score Badge (Left) -->
    <div
      class="flex-shrink-0 w-12 h-12 rounded-lg bg-slate-900 border border-slate-700 flex flex-col items-center justify-center">
      <span class="text-lg font-bold leading-none" [class.text-blue-400]="(item.totalScore || 0) >= 60"
        [class.text-green-400]="(item.totalScore || 0) >= 80" [class.text-purple-400]="(item.totalScore || 0) >= 90"
        [class.text-gray-400]="(item.totalScore || 0) < 60">
        {{ item.totalScore || 0 }}
      </span>
    </div>

    <!-- Main Content -->
    <div class="flex-grow min-w-0 flex flex-col justify-center">
      <h3 class="text-base font-bold text-slate-100 truncate group-hover:text-blue-400 transition-colors">
        {{ item.title }}
      </h3>
      <div class="flex items-center gap-3 text-xs text-slate-400 mt-1">
        <span class="font-bold text-slate-200">{{ item.source }}</span>
        <span class="w-1 h-1 bg-slate-600 rounded-full"></span>
        <span>{{ item.publishedDate | date:'MMM d' }}</span>
        <span class="w-1 h-1 bg-slate-600 rounded-full"></span>
        <span>{{ readingTime() }}</span>
      </div>
    </div>

    <!-- Right Side: Band & Actions -->
    <div class="flex-shrink-0 flex items-center gap-4">
      @if (item.scoreBand) {
      <span class="px-3 py-1 text-xs font-bold uppercase tracking-wider rounded border hidden sm:inline-block"
        [class]="scoreBandClass()">
        {{ item.scoreBand }}
      </span>
      }
      <!-- Spacer for absolute save button -->
      <div class="w-8"></div>
    </div>
  </div>
  }
</div>
}